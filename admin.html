<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    h2 { margin-top: 40px; }
    table { border-collapse: collapse; width: 100%; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background-color: #f5f5f5; }
    .section { margin-bottom: 40px; }
  </style>
</head>
<body>

  <h1>👩‍💼 Admin Dashboard</h1>
  <p>Xin chào, <span id="admin-name">Admin</span> | <a href="#" onclick="logout()">Đăng xuất</a></p>

  <div class="section">
    <h2>📦 Quản lý Hàng hóa</h2>
    <table id="products-table">
      <thead>
        <tr><th>Tên sản phẩm</th><th>Giá</th><th>Số lượng</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <div class="section">
    <h2>🧾 Quản lý Đơn hàng</h2>
    <table id="orders-table">
      <thead>
        <tr><th>Mã đơn</th><th>Khách</th><th>Tổng tiền</th><th>Trạng thái</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <div class="section">
    <h2>👤 Quản lý Khách hàng</h2>
    <table id="customers-table">
      <thead>
        <tr><th>Email</th><th>Họ tên</th><th>SĐT</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    const role = localStorage.getItem('role');
    const token = localStorage.getItem('token');
    const adminName = localStorage.getItem('userName') || 'Admin';

    if (role !== 'admin') {
      alert('Bạn không có quyền truy cập');
      window.location.href = '/index.html';
    }

    document.getElementById('admin-name').textContent = adminName;

    async function fetchAndRender(endpoint, tableId, mapRow) {
      try {
        const res = await fetch(`https://backend-7j0i.onrender.com${endpoint}`, {
          headers: { Authorization: `Bearer ${token}` }
        });
        const data = await res.json();
        const tbody = document.querySelector(`${tableId} tbody`);
        tbody.innerHTML = '';
        data.forEach(item => {
          const row = mapRow(item);
          tbody.appendChild(row);
        });
      } catch (err) {
        console.error(`Lỗi khi tải ${endpoint}:`, err);
      }
    }

    function createRow(cells) {
      const tr = document.createElement('tr');
      cells.forEach(text => {
        const td = document.createElement('td');
        td.textContent = text;
        tr.appendChild(td);
      });
      return tr;
    }

    function logout() {
      localStorage.clear();
      window.location.href = '/login.html';
    }

    // Load dữ liệu
    fetchAndRender('/products', '#products-table', (p) =>
      createRow([p.name, `${p.price}₫`, p.quantity])
    );
    fetchAndRender('/orders/all', '#orders-table', (o) =>
      createRow([o.orderCode, o.shippingAddress?.fullName, `${o.finalAmount}₫`, o.orderStatus])
    );
    fetchAndRender('/customers', '#customers-table', (c) =>
      createRow([c.email, c.fullName, c.phone])
    );
  </script>
</body>
</html>
