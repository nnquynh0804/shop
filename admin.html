<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    h2 { margin-top: 40px; }
    table { border-collapse: collapse; width: 100%; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background-color: #f5f5f5; }
    .section { margin-bottom: 40px; }
  </style>
</head>
<body>

  <h1>ğŸ‘©â€ğŸ’¼ Admin Dashboard</h1>
  <p>Xin chÃ o, <span id="admin-name">Admin</span> | <a href="#" onclick="logout()">ÄÄƒng xuáº¥t</a></p>

  <div class="section">
    <h2>ğŸ“¦ Quáº£n lÃ½ HÃ ng hÃ³a</h2>
    <table id="products-table">
      <thead>
        <tr><th>TÃªn sáº£n pháº©m</th><th>GiÃ¡</th><th>Sá»‘ lÆ°á»£ng</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <div class="section">
    <h2>ğŸ§¾ Quáº£n lÃ½ ÄÆ¡n hÃ ng</h2>
    <table id="orders-table">
      <thead>
        <tr><th>MÃ£ Ä‘Æ¡n</th><th>KhÃ¡ch</th><th>Tá»•ng tiá»n</th><th>Tráº¡ng thÃ¡i</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <div class="section">
    <h2>ğŸ‘¤ Quáº£n lÃ½ KhÃ¡ch hÃ ng</h2>
    <table id="customers-table">
      <thead>
        <tr><th>Email</th><th>Há» tÃªn</th><th>SÄT</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    const role = localStorage.getItem('role');
    const token = localStorage.getItem('token');
    const adminName = localStorage.getItem('userName') || 'Admin';

    if (role !== 'admin') {
      alert('Báº¡n khÃ´ng cÃ³ quyá»n truy cáº­p');
      window.location.href = '/index.html';
    }

    document.getElementById('admin-name').textContent = adminName;

    async function fetchAndRender(endpoint, tableId, mapRow) {
      try {
        const res = await fetch(`https://backend-7j0i.onrender.com${endpoint}`, {
          headers: { Authorization: `Bearer ${token}` }
        });
        const data = await res.json();
        const tbody = document.querySelector(`${tableId} tbody`);
        tbody.innerHTML = '';
        data.forEach(item => {
          const row = mapRow(item);
          tbody.appendChild(row);
        });
      } catch (err) {
        console.error(`Lá»—i khi táº£i ${endpoint}:`, err);
      }
    }

    function createRow(cells) {
      const tr = document.createElement('tr');
      cells.forEach(text => {
        const td = document.createElement('td');
        td.textContent = text;
        tr.appendChild(td);
      });
      return tr;
    }

    function logout() {
      localStorage.clear();
      window.location.href = '/login.html';
    }

    // Load dá»¯ liá»‡u
    fetchAndRender('/products', '#products-table', (p) =>
      createRow([p.name, `${p.price}â‚«`, p.quantity])
    );
    fetchAndRender('/orders/all', '#orders-table', (o) =>
      createRow([o.orderCode, o.shippingAddress?.fullName, `${o.finalAmount}â‚«`, o.orderStatus])
    );
    fetchAndRender('/customers', '#customers-table', (c) =>
      createRow([c.email, c.fullName, c.phone])
    );
  </script>
</body>
</html>
